cat << 'EOF' > start.sh
#!/bin/bash

# --- C·∫§U H√åNH ---
WEBHOOK_URL="https://discord.com/api/webhooks/1460633815578968239/E5Ck-CCpCwQNUtGXA9z-VpWwcQzZz7M7meSapdb8i7f0cZ_XdnOg4EHeCQ6x4rfmga_2"

while true
do
    echo "--- B·∫ÆT ƒê·∫¶U CHU K·ª≤ M·ªöI ---"
    
    # 1. D·ªçn d·∫πp c≈©
    pkill -9 -f pinggy
    rm -f java.log bedrock.log
    sleep 2

    # 2. Kh·ªüi ch·∫°y thu·∫ßn t√∫y (Kh√¥ng d√πng b·∫•t k·ª≥ flag n√†o ngo√†i l·ªánh g·ªëc)
    # Ch√∫ng ta d√πng "stdbuf" ƒë·ªÉ √©p n√≥ ghi d·ªØ li·ªáu v√†o log ngay l·∫≠p t·ª©c
    stdbuf -oL ./pinggy -p 443 -R0:localhost:25565 tcp@free.pinggy.io > java.log 2>&1 &
    stdbuf -oL ./pinggy -p 443 -R0:localhost:25565 udp@free.pinggy.io > bedrock.log 2>&1 &

    echo "ƒêang ƒë·ª£i Pinggy thi·∫øt l·∫≠p k·∫øt n·ªëi..."
    
    # V√≤ng l·∫∑p ch·ªù IP (ki·ªÉm tra m·ªói 5 gi√¢y trong v√≤ng 1 ph√∫t)
    JAVA_IP=""
    BEDROCK_RAW=""
    for i in {1..12}
    do
        sleep 5
        # T√¨m chu·ªói IP trong log
        JAVA_IP=$(grep -oE "[a-z0-9.-]+\.free\.pinggy\.(io|link):[0-9]+" java.log | head -n 1)
        BEDROCK_RAW=$(grep -oE "[a-z0-9.-]+\.free\.pinggy\.(io|link):[0-9]+" bedrock.log | head -n 1)
        
        if [ -n "$JAVA_IP" ] && [ -n "$BEDROCK_RAW" ]; then
            echo "‚úÖ ƒê√£ l·∫•y ƒë∆∞·ª£c IP!"
            break
        fi
        echo "‚è≥ ƒêang k·∫øt n·ªëi... ($((i*5))s)"
    done

    # 3. G·ª≠i Webhook n·∫øu th√†nh c√¥ng
    if [ -n "$JAVA_IP" ] && [ -n "$BEDROCK_RAW" ]; then
        B_HOST=$(echo $BEDROCK_RAW | cut -d':' -f1)
        B_PORT=$(echo $BEDROCK_RAW | cut -d':' -f2)

        curl -H "Content-Type: application/json" -X POST -d '{
          "content": "‚úÖ **M√ÅY CH·ª¶ ƒê√É TR·ª∞C TUY·∫æN!**",
          "embeds": [{
            "title": "üéÆ TH√îNG TIN MINECRAFT",
            "color": 65280,
            "fields": [
              { "name": "‚òï Java Edition", "value": "IP: `'"$JAVA_IP"'`" },
              { "name": "üì± Bedrock Edition", "value": "IP: `'"$B_HOST"'` \nPort: `'"$B_PORT"'`" }
            ],
            "footer": { "text": "H·ªá th·ªëng t·ª± ƒë·ªông reset sau 60 ph√∫t" }
          }]
        }' $WEBHOOK_URL
        
        echo "üöÄ ƒê√£ xong! Ch·ªù 60 ph√∫t..."
        sleep 3600
    else
        echo "‚ùå Kh√¥ng l·∫•y ƒë∆∞·ª£c IP. N·ªôi dung log cu·ªëi c√πng:"
        tail -n 5 java.log
        sleep 20
    fi
done
EOF
        echo "‚è≥ V·∫´n ƒëang k·∫øt n·ªëi... ($((i*5))s)"
    done

    # 3. Ki·ªÉm tra k·∫øt qu·∫£ v√† g·ª≠i Discord
    if [ -n "$JAVA_IP" ] && [ -n "$BEDROCK_RAW" ]; then
        B_HOST=$(echo $BEDROCK_RAW | cut -d':' -f1)
        B_PORT=$(echo $BEDROCK_RAW | cut -d':' -f2)

        curl -H "Content-Type: application/json" -X POST -d '{
          "content": "‚úÖ **M√ÅY CH·ª¶ ƒê√É TR·ª∞C TUY·∫æN!**",
          "embeds": [{
            "title": "üéÆ TH√îNG TIN MINECRAFT",
            "color": 65280,
            "fields": [
              { "name": "‚òï Java Edition", "value": "IP: `'"$JAVA_IP"'`" },
              { "name": "üì± Bedrock Edition", "value": "IP: `'"$B_HOST"'` \nPort: `'"$B_PORT"'`" }
            ],
            "footer": { "text": "H·ªá th·ªëng t·ª± ƒë·ªông l√†m m·ªõi sau 1 gi·ªù" }
          }]
        }' $WEBHOOK_URL
        
        echo "üöÄ ƒê√£ g·ª≠i IP l√™n Discord. Ch·ªù 60 ph√∫t ƒë·ªÉ reset..."
        sleep 3600
    else
        echo "‚ùå L·ªói: Qu√° th·ªùi gian ch·ªù (1 ph√∫t) m√† kh√¥ng th·∫•y IP."
        echo "--- N·ªôi dung Log Java (Ki·ªÉm tra l·ªói t·∫°i ƒë√¢y) ---"
        cat java.log
        echo "--------------------------------------------"
        sleep 30
    fi
done
EOF

    # 3. Ki·ªÉm tra k·∫øt qu·∫£ v√† g·ª≠i Discord
    if [ -n "$JAVA_IP" ] && [ -n "$BEDROCK_RAW" ]; then
        B_HOST=$(echo $BEDROCK_RAW | cut -d':' -f1)
        B_PORT=$(echo $BEDROCK_RAW | cut -d':' -f2)

        curl -H "Content-Type: application/json" -X POST -d '{
          "content": "‚úÖ **M√ÅY CH·ª¶ ƒê√É TR·ª∞C TUY·∫æN!**",
          "embeds": [{
            "title": "üéÆ TH√îNG TIN MINECRAFT",
            "color": 65280,
            "fields": [
              { "name": "‚òï Java Edition", "value": "IP: `'"$JAVA_IP"'`" },
              { "name": "üì± Bedrock Edition", "value": "IP: `'"$B_HOST"'` \nPort: `'"$B_PORT"'`" }
            ],
            "footer": { "text": "H·ªá th·ªëng t·ª± ƒë·ªông l√†m m·ªõi sau 1 gi·ªù" }
          }]
        }' $WEBHOOK_URL
        
        echo "‚úÖ ƒê√£ g·ª≠i IP l√™n Discord. Ch·ªù 60 ph√∫t ƒë·ªÉ reset..."
        sleep 3600
    else
        echo "‚ùå L·ªói: Qu√° th·ªùi gian ch·ªù m√† kh√¥ng l·∫•y ƒë∆∞·ª£c IP."
        echo "--- N·ªôi dung Log Java ---"
        cat java.log
        sleep 30
    fi
done
EOF
