cat << 'EOF' > start.sh
#!/bin/bash
WEBHOOK="https://discord.com/api/webhooks/1460633815578968239/E5Ck-CCpCwQNUtGXA9z-VpWwcQzZz7M7meSapdb8i7f0cZ_XdnOg4EHeCQ6x4rfmga_2"

# 1. Dá»n dáº¹p tiáº¿n trÃ¬nh cÅ© náº¿u cÃ³
pkill -9 pinggy > /dev/null 2>&1

# 2. Cháº¡y 2 lá»‡nh báº¡n cáº§n (Ä‘áº©y vÃ o file táº¡m Ä‘á»ƒ láº¥y link)
./pinggy -p 443 -R0:127.0.0.1:25565 -o StrictHostKeyChecking=no -o ServerAliveInterval=30 pt70EXJbPWH+tcp@ap.free.pinggy.io > java.log 2>&1 &
./pinggy -p 443 -R0:127.0.0.1:25565 pt70EXJbPWH+udp@ap.free.pinggy.io > bedrock.log 2>&1 &

echo "â³ Äang láº¥y IP... Äá»£i 8 giÃ¢y..."
sleep 8

# 3. Lá»c link chuáº©n (bá» qua cÃ¡c kÃ½ tá»± láº¡ cá»§a terminal)
JAVA_URL=$(grep -oE "[a-z0-9.-]+\.a\.free\.pinggy\.link:[0-9]+" java.log | head -n 1)
BEDROCK_URL=$(grep -oE "[a-z0-9.-]+\.a\.free\.pinggy\.link:[0-9]+" bedrock.log | head -n 1)

# 4. Gá»­i Discord (Chá»‰ gá»­i náº¿u láº¥y Ä‘Æ°á»£c link)
if [ -z "$JAVA_URL" ] && [ -z "$BEDROCK_URL" ]; then
    echo "âŒ Lá»—i: KhÃ´ng láº¥y Ä‘Æ°á»£c IP tá»« Pinggy. Thá»­ cháº¡y láº¡i lá»‡nh cat java.log Ä‘á»ƒ xem lá»—i."
else
    curl -X POST -H "Content-Type: application/json" -d "{
      \"content\": \"ğŸš€ **SERVER MINECRAFT ÄÃƒ Sáº´N SÃ€NG!**\",
      \"embeds\": [{
        \"color\": 65280,
        \"fields\": [
          { \"name\": \"ğŸ–¥ï¸ Java IP\", \"value\": \"\`$JAVA_URL\`\" },
          { \"name\": \"ğŸ“± Bedrock IP\", \"value\": \"\`$BEDROCK_URL\`\" }
        ]
      }]
    }" $WEBHOOK
    echo "âœ… ÄÃ£ gá»­i IP lÃªn Discord!"
fi
EOF

chmod +x start.sh
./start.sh
./run_mc.sh
# --- Gá»¬I DISCORD ---
PAYLOAD=$(cat <<EOF
{
  "embeds": [{
    "title": "ğŸ® SERVER MINECRAFT ASIA ONLINE",
    "description": "Server Ä‘ang cháº¡y á»•n Ä‘á»‹nh trÃªn server ChÃ¢u Ã (Ping tháº¥p)",
    "color": 65280,
    "fields": [
      { "name": "ğŸ–¥ï¸ JAVA EDITION", "value": "\`$JAVA_IP\`" },
      { "name": "ğŸ“± BEDROCK IP", "value": "\`$B_IP\`", "inline": true },
      { "name": "ğŸ”¢ PORT", "value": "\`$B_PORT\`", "inline": true }
    ],
    "footer": { "text": "Cung cáº¥p bá»Ÿi Pinggy Asia Tunnel" }
  }]
}
EOF
)

curl -H "Content-Type: application/json" -X POST -d "$PAYLOAD" $WEBHOOK_URL
echo "âœ… ÄÃ£ gá»­i thÃ´ng tin IP lÃªn Discord thÃ nh cÃ´ng!"
