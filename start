cat << 'EOF' > start_mc_60min.sh
#!/bin/bash

# --- Cáº¤U HÃŒNH ---
WEBHOOK_URL="https://discord.com/api/webhooks/1460633815578968239/E5Ck-CCpCwQNUtGXA9z-VpWwcQzZz7M7meSapdb8i7f0cZ_XdnOg4EHeCQ6x4rfmga_2"
PINGGY_CMD="./pinggy -p 443 -R0:localhost:25565 tcp@free.pinggy.io"

while true
do
    echo "--- Báº®T Äáº¦U CHU Ká»² Má»šI ($(date)) ---"

    # 1. Táº¯t cÃ¡c phiÃªn báº£n Pinggy cÅ© Ä‘ang cháº¡y ngáº§m (náº¿u cÃ³)
    pkill -f pinggy
    sleep 2

    # 2. Khá»Ÿi Ä‘á»™ng Pinggy má»›i (cháº¡y ngáº§m)
    $PINGGY_CMD > pinggy.log 2>&1 &
    echo "Äang khá»Ÿi Ä‘á»™ng Pinggy..."

    # Äá»£i 10 giÃ¢y Ä‘á»ƒ Pinggy láº¥y IP á»•n Ä‘á»‹nh
    sleep 10

    # 3. Láº¥y IP tá»« API ná»™i bá»™
    IP_ADDR=$(curl -s http://localhost:4300/urls | grep -oE "[a-z0-9.-]+\.free\.pinggy\.io:[0-9]+")

    if [ -n "$IP_ADDR" ]; then
        HOST=$(echo $IP_ADDR | cut -d':' -f1)
        PORT=$(echo $IP_ADDR | cut -d':' -f2)

        # 4. Gá»­i Webhook lÃªn Discord
        curl -H "Content-Type: application/json" \
             -X POST \
             -d '{
          "content": "ğŸ”„ **Cáº¬P NHáº¬T IP SERVER (Tá»± Ä‘á»™ng má»—i 60p)**",
          "embeds": [{
            "title": "ğŸ® THÃ”NG TIN Káº¾T Ná»I Má»šI",
            "color": 3447003,
            "fields": [
              { "name": "â˜• Java Edition", "value": "```'"$IP_ADDR"'```", "inline": false },
              { "name": "ğŸ“± Bedrock Edition", "value": "IP: `'"$HOST"'` \nPort: `'"$PORT"'`", "inline": false }
            ],
            "footer": { "text": "Láº§n cáº­p nháº­t káº¿ tiáº¿p: sau 60 phÃºt ná»¯a" },
            "timestamp": "'$(date -u +%Y-%m-%dT%H:%M:%SZ)'"
          }]
        }' $WEBHOOK_URL
        
        echo "ÄÃ£ gá»­i IP má»›i: $IP_ADDR"
    else
        echo "Lá»—i: KhÃ´ng láº¥y Ä‘Æ°á»£c IP. Sáº½ thá»­ láº¡i sau."
    fi

    echo "Äang chá» 60 phÃºt Ä‘á»ƒ lÃ m má»›i..."
    # 5. Ngá»§ 60 phÃºt (3600 giÃ¢y)
    sleep 3600
done
EOF
